<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <title>ArcSys Harita</title>

    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script src="leaflet/leaflet.js"></script>
    <link rel="stylesheet" href="map_style.css" />

    <script>
      // Python bu değişkeni dolduruyor:
      const THEME_CSS_VARS = `__THEME_CSS_VARS__`;

      // CSS değişkenlerini DOM'a bas
      const root = document.documentElement;

      THEME_CSS_VARS.split("\n").forEach((line) => {
        const trimmed = line.trim();
        if (!trimmed) return;
        const [key, value] = trimmed.replace(";", "").split(":");
        if (key && value) {
          root.style.setProperty(key.trim(), value.trim());
        }
      });
    </script>
  </head>

  <body>
    <div id="map"></div>
    <!-- ÜSTTE TEK SATIR FİLTRE + ZOOM + KATMANLAR -->
    <div id="filter-container">
      <!-- Metin filtresi -->
      <div class="filter-group">
        <div id="zoom-controls">
          <button id="zoom-out-btn" title="Uzaklaştır">−</button>
          <span id="zoom-level-label"></span>
          <button id="zoom-in-btn" title="Yakınlaştır">+</button>
        </div>
        <input id="filter-input" placeholder="Ara: buluntu / açma / seviye" />
      </div>

      <!-- Tarih aralığı -->
      <div class="date-filter-group">
        <input
          id="date-from"
          type="text"
          inputmode="numeric"
          placeholder="gg.aa.yyyy"
          title="Başlangıç tarihi (gg.aa.yyyy)"
        />
        <span class="filter-separator">–</span>
        <input
          id="date-to"
          type="text"
          inputmode="numeric"
          placeholder="gg.aa.yyyy"
          title="Bitiş tarihi (gg.aa.yyyy)"
        />
        <button id="date-filter-clear" title="Tarih filtresini temizle">
          ×
        </button>
      </div>

      <!-- Seviye (Z) aralığı slider -->
      <div class="filter-group" id="depth-filter-group">
        <div id="depth-label-row">
          <span class="depth-title">Seviye:</span>
          <span id="depth-range-label"></span>
        </div>
        <div id="depth-slider-row">
          <input type="range" id="depth-min" step="0.01" />
          <input type="range" id="depth-max" step="0.01" />
        </div>
      </div>

      <!-- Altlık seçimi -->
      <div class="filter-group" id="basemap-group">
        <span class="filter-label">Altlık:</span>
        <select id="basemap-select" title="Altlık haritası seç">
          <option value="osm">OSM (Standart)</option>
          <option value="osm_hot">OSM Humanitarian</option>
          <option value="opentopo">OpenTopoMap</option>
          <option value="carto_light">Carto Light</option>
          <option value="carto_dark">Carto Dark</option>
          <option value="carto_voyager">Carto Voyager</option>
          <option value="None">Altlık Yok</option>
        </select>
      </div>

      <!-- Sağ taraf: Zoom + Katmanlar -->
      <div id="filter-right-group">
        <!-- Zoom kontrolleri -->

        <!-- Katman paneli artık üst bar içinde -->
        <div id="layer-panel" class="collapsed">
          <div id="layer-panel-header">
            <span class="title">Katmanlar</span>
            <span class="toggle-icon">▸</span>
          </div>
          <div id="layer-panel-body">
            <div id="layer-list"></div>
          </div>
        </div>
      </div>
    </div>
    <script>
      const trenchesData = __TRENCHES_JSON__;
      const findsData = __FINDS_JSON__;
      const extraLayers = __LAYERS_JSON__;
      const errorMsg = "__ERROR_MSG__";
      const centerLat = __CENTER_LAT__;
      const centerLon = __CENTER_LON__;
      window.vectorLayers = __VECTOR_LAYERS_JSON__;
    </script>
    <script src="map_script.js"></script>
  </body>
</html>
